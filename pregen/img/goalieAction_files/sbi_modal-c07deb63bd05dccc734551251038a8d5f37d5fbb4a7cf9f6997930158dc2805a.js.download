(function(){angular.module("giSearchByImage",["ngFileUpload","common.services","ng-rails-csrf","giCurrentSite"]),angular.module("giSearchByImage").factory("errorHandler",function(){var e;return e=function(e){return null!=e&&-1!==e.indexOf("<")},{parseError:function(t){var n,r,i,a,o,s,c,u,l;if(i=$.extend({},t),e(t.data))try{(n=$($.parseXML(t.data)))&&(i.code=null!=(a=n.find("Code"))?a.text():void 0,i.message=null!=(o=n.find("Message"))?o.text():void 0,i.resource=null!=(s=n.find("Resource"))?s.text():void 0,i.requestId=null!=(c=n.find("RequestId"))?c.text():void 0,i.location=null!=(u=n.find("Location"))?u.text():void 0,(null!=(l=i.message)?l.search(/condition failed.*content-type/):void 0)>=0&&(i.code="InvalidContentType"))}catch(d){r=d,i.message="invalid response: "+r}return i}}}),angular.module("giSearchByImage").directive("sbiModal",["Upload","$http","errorHandler","clientEventService","$q","currentSite","sbiTrackingService",function(e,t,n,r,i,a,o){var s;return s=function(s,c){var u,l,d,f,p,h,g,m,v,y,w,_,b,k,S,x,C,A,E,T;return s.errors={},s.fileErrors={},s.isDrag=!1,x="",window.eventBus&&eventBus.on("sbi-open-modal",function(){return function(){return c.trigger("track.sbi.modalOpen"),$(".gi-sbi-modal").show(),$(".search-by-image-modal .overlay").addClass("active"),$(".search-by-image-modal .modal-wrapper").addClass("active"),$(".search-by-image-modal .modal").addClass("active"),$("body").removeClass("show-right-menu"),$("html, body").css({height:"100%"}),!1}}(this)),$(window).on("dragenter",function(e){return $(".modal-wrapper").hasClass("active")||!C(e)?!0:(e.preventDefault(),s.isDrag=!0,b(),!1)}),$(document).on("dragstart",".draggable",function(e){var t,n,r,i,a,o,s,c;e.dataTransfer.effectAllowed="copy",n=$(e.target),t=null!=(o=n.closest(".mosaic-asset"))?null!=(s=o.find(".search-result-asset-link"))?null!=(c=s.find("img"))?c.first():void 0:void 0:void 0,i=t?t.prop("src"):"",r=t?t.prop("outerHTML"):"";try{e.dataTransfer.setData("text/uri-list",i),e.dataTransfer.setData("text/html",r),e.dataTransfer.setData("text",i),e.dataTransfer.setData("text/plain",i),e.dataTransfer.setDragImage(t[0],0,0)}catch(u){a=u,e.dataTransfer.setData("text",i)}return!0}),$(document).on("drag",".draggable",function(){return $(".modal-wrapper").hasClass("active")?!1:(x=$(this).attr("data-asset-id"),b(),!1)}),C=function(e){return m(e)||v(e)},m=function(e){var t;return-1!==(null!=(t=e.originalEvent.dataTransfer.types)?t[0].indexOf("Files"):void 0)},v=function(e){return e.target&&$(e.target).is("img")},S=function(){return s.errors.showDimensionError=!1,s.errors.showFileSizeError=!1,s.errors.showFileTypeError=!1,s.errors.showGenericError=!1,s.isDrag=!1},S(),u=c.find(".close-icon"),k=c.find(".overlay"),w=c.find(".modal-wrapper"),y=c.find(".sbi-bounce-wrapper"),u.on("click",function(){return l()}),k.on("click",function(){return l()}),s.$watchCollection("fileErrors",function(){var e;if(e=s.fileErrors){if(S(),"dimensions"===e.$error)return s.errors.showDimensionError=!0,o.sendEvent("ImgSrch_lessthanFourthousand",a.isGetty?"event183":"event158");if("maxSize"===e.$error)return s.errors.showFileSizeError=!0,o.sendEvent("ImgSrch_lessthanFiveMB",a.isGetty?"event183":"event159");if("pattern"===e.$error)return s.errors.showFileTypeError=!0,o.sendEvent("ImgSrch_uploadJPGorPNG",a.isGetty?"event183":"event157");if("general"===e.$error)return s.errors.showGenericError=!0,o.sendEvent("ImgSrch_somethingwrngError",a.isGetty?"event183":"event161")}}),"true"===c.attr("sbi-error")&&(s.fileErrors.$error="general"),s.dragDropOutsideModal=function(){return l(!0)},s.dragDropUpload=function(e){return null!==e?(o.sendEvent("ImgSrch_droppedImage","event148"),o.sendGtmEvent("SearchByImageDragandDropFile"),T(e)):void 0},s.fileSelectorUpload=function(e){return null!==e?(o.sendEvent("ImgSrch_chooseFile",a.isGetty?"event182":"event155"),o.sendGtmEvent("SearchByImageChooseFile"),T(e)):void 0},T=function(t){var i,c;return null!==t?(c=s.isDrag,A(),S(),o.sendEvent("ImgSrch_uploadingImg","event160"),null!=t.$ngfName&&("function"==typeof(i=t.$ngfName).includes?i.includes(x):void 0)||(x=""),f(x).then(function(i){var u;return s.remote_data=i,u=StopWatch.start(),e.upload({url:s.remote_data.url,data:{key:s.remote_data.key,AWSAccessKeyId:s.remote_data.AWSAccessKeyId,acl:s.remote_data.acl,policy:s.remote_data.policy,signature:s.remote_data.signature,"Content-Type":""!==t.type?t.type:"application/octet-stream",success_action_redirect:s.remote_data.success_action_redirect,success_action_status:s.remote_data.success_action_status,file:t},timeout:s.remote_data.timeout}).then(function(e){var t,i;i=n.parseError(e),r.sendClientEvent("search_by_image",{event:"upload",status:i.status,location:i.location,drag:c}),r.sendClientEvent("search_by_image",{event:"upload timing",startTime:u.startTime,duration:u.elapsed()});try{localStorage.setItem("searchbyimage.hidetooltip","true")}catch(a){t=a}location.href=s.remote_data.presigned_url},function(e){var t;t=n.parseError(e),"EntityTooLarge"===t.code?(s.errors.showFileSizeError=!0,o.sendEvent("ImgSrch_lessthanFiveMB",a.isGetty?"event183":"event159")):"InvalidContentType"===t.code?(s.errors.showFileTypeError=!0,o.sendEvent("ImgSrch_uploadJPGorPNG",a.isGetty?"event183":"event157")):(s.errors.showGenericError=!0,o.sendEvent("ImgSrch_somethingwrngError",a.isGetty?"event183":"event161")),r.sendClientEvent("search_by_image",{event:"upload.error",status:t.status,error:t.message,code:t.code,drag:c}),g()},function(){return void 0})},function(e){return r.sendClientEvent("search_by_image",{event:"getdata.error",status:e.status,error:e,drag:c})})):void 0},b=function(){return window.eventBus&&_()?eventBus.trigger("sbi-open-modal"):void 0},l=function(e){return null==e&&(e=!1),o.handleCloseEvent(s.errors,e),S(),d(),k.removeClass("active"),w.removeClass("active"),s.$apply()},_=function(){return a.isGetty&&window.upsSearchData&&"image"===window.upsSearchData.type&&("creative"===window.upsSearchData.family||!window.upsSearchData.family)||a.isiStock&&!$(".search-bar__camera").hasClass("video-selected")},h=function(){var e,t;return a.isGetty?(e=p(),t=$("body").hasClass("search_container")?e&&e.license?"&license="+e.license:"":$("#creative-image-rf").is(":checked")&&$("#creative-image-rm").is(":checked")?"":$("#creative-image-rf").is(":checked")?"&license=rf":"&license=rm"):""},p=function(){var e,t,n,r,i,a,o,s,c;if(t=localStorage.getItem("search.lastSearchParameters"),a={},null!=t)for(o=t.toLowerCase().split("&"),e=0,n=o.length;n>e;e++)i=o[e],s=i.split("="),r=s[0],c=s[1],a[r]=void 0===a[r]?decodeURIComponent(c):a[r]+","+decodeURIComponent(c);return a},f=function(e){var n;return n=""===e?"/search/search-by-image/upload_data/"+E():"/search/search-by-image/upload_data/"+E()+"?assetid="+e,i(function(e,r){return t({method:"GET",url:n}).then(function(t){return e(t.data)},function(e){return r(e)})})},E=function(){return Date.now?Date.now():Date().getTime()},d=function(){return $("html, body").css({overflow:"visible",height:"auto"})},A=function(){w.hide(),k.off("click"),y.show()},g=function(){w.show(),k.on("click",function(){return l()}),y.hide()}},{restrict:"A",link:s}}])}).call(this),!window.XMLHttpRequest||window.FileAPI&&FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=function(e){return function(t,n){if("__setXHR_"===t){var r=n(this);r instanceof Function&&r(this)}else e.apply(this,arguments)}}(window.XMLHttpRequest.prototype.setRequestHeader));var ngFileUpload=angular.module("ngFileUpload",[]);ngFileUpload.version="12.2.13",ngFileUpload.service("UploadBase",["$http","$q","$timeout",function(e,t,n){function r(r){function i(e){u.notify&&u.notify(e),l.progressFunc&&n(function(){l.progressFunc(e)})}function s(e){return null!=r._start&&o?{loaded:e.loaded+r._start,total:r._file&&r._file.size||e.total,type:e.type,config:r,lengthComputable:!0,target:e.target}:e}function c(){e(r).then(function(e){if(o&&r._chunkSize&&!r._finished&&r._file){var t=r._file&&r._file.size||0;i({loaded:Math.min(r._end,t),total:t,config:r,type:"progress"}),a.upload(r,!0)}else r._finished&&delete r._finished,u.resolve(e)},function(e){u.reject(e)},function(e){u.notify(e)})}r.method=r.method||"POST",r.headers=r.headers||{};var u=r._deferred=r._deferred||t.defer(),l=u.promise;return r.disableProgress||(r.headers.__setXHR_=function(){return function(e){e&&e.upload&&e.upload.addEventListener&&(r.__XHR=e,r.xhrFn&&r.xhrFn(e),e.upload.addEventListener("progress",function(e){e.config=r,i(s(e))},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&(e.config=r,i(s(e)))},!1))}}),o?r._chunkSize&&r._end&&!r._finished?(r._start=r._end,r._end+=r._chunkSize,c()):r.resumeSizeUrl?e.get(r.resumeSizeUrl).then(function(e){r._start=r.resumeSizeResponseReader?r.resumeSizeResponseReader(e.data):parseInt((null==e.data.size?e.data:e.data.size).toString()),r._chunkSize&&(r._end=r._start+r._chunkSize),c()},function(e){throw e}):r.resumeSize?r.resumeSize().then(function(e){r._start=e,r._chunkSize&&(r._end=r._start+r._chunkSize),c()},function(e){throw e}):(r._chunkSize&&(r._start=0,r._end=r._start+r._chunkSize),c()):c(),l.success=function(e){return l.then(function(t){e(t.data,t.status,t.headers,r)}),l},l.error=function(e){return l.then(null,function(t){e(t.data,t.status,t.headers,r)}),l},l.progress=function(e){return l.progressFunc=e,l.then(null,null,function(t){e(t)}),l},l.abort=l.pause=function(){return r.__XHR&&n(function(){r.__XHR.abort()}),l},l.xhr=function(e){return r.xhrFn=function(t){return function(){t&&t.apply(l,arguments),e.apply(l,arguments)}}(r.xhrFn),l},a.promisesCount++,l["finally"]&&l["finally"]instanceof Function&&l["finally"](function(){a.promisesCount--}),l}function i(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var a=this;a.promisesCount=0,this.isResumeSupported=function(){return window.Blob&&window.Blob.prototype.slice};var o=this.isResumeSupported();this.isUploadInProgress=function(){return a.promisesCount>0},this.rename=function(e,t){return e.ngfName=t,e},this.jsonBlob=function(e){null==e||angular.isString(e)||(e=JSON.stringify(e));var t=new window.Blob([e],{type:"application/json"});return t._ngfBlob=!0,t},this.json=function(e){return angular.toJson(e)},this.isFile=function(e){return null!=e&&(e instanceof window.Blob||e.flashId&&e.name&&e.size)},this.upload=function(e,t){function n(t,n){if(t._ngfBlob)return t;if(e._file=e._file||t,null!=e._start&&o){e._end&&e._end>=t.size&&(e._finished=!0,e._end=t.size);var r=t.slice(e._start,e._end||t.size);return r.name=t.name,r.ngfName=t.ngfName,e._chunkSize&&(n.append("_chunkSize",e._chunkSize),n.append("_currentChunkSize",e._end-e._start),n.append("_chunkNumber",Math.floor(e._start/e._chunkSize)),n.append("_totalSize",e._file.size)),r}return t}function s(t,r,i){if(void 0!==r)if(angular.isDate(r)&&(r=r.toISOString()),angular.isString(r))t.append(i,r);else if(a.isFile(r)){var o=n(r,t),c=i.split(",");c[1]&&(o.ngfName=c[1].replace(/^\s+|\s+$/g,""),i=c[0]),e._fileKey=e._fileKey||i,t.append(i,o,o.ngfName||o.name)}else if(angular.isObject(r)){if(r.$$ngfCircularDetection)throw"ngFileUpload: Circular reference in config.data. Make sure specified data for Upload.upload() has no circular reference: "+i;r.$$ngfCircularDetection=!0;try{for(var u in r)if(r.hasOwnProperty(u)&&"$$ngfCircularDetection"!==u){var l=null==e.objectKey?"[i]":e.objectKey;r.length&&parseInt(u)>-1&&(l=null==e.arrayKey?l:e.arrayKey),s(t,r[u],i+l.replace(/[ik]/g,u))}}finally{delete r.$$ngfCircularDetection}}else t.append(i,r)}function c(){e._chunkSize=a.translateScalars(e.resumeChunkSize),e._chunkSize=e._chunkSize?parseInt(e._chunkSize.toString()):null,e.headers=e.headers||{},e.headers["Content-Type"]=void 0,e.transformRequest=e.transformRequest?angular.isArray(e.transformRequest)?e.transformRequest:[e.transformRequest]:[],e.transformRequest.push(function(t){var n,r=new window.FormData;t=t||e.fields||{},e.file&&(t.file=e.file);for(n in t)if(t.hasOwnProperty(n)){var i=t[n];e.formDataAppender?e.formDataAppender(r,n,i):s(r,i,n)}return r})}return t||(e=i(e)),e._isDigested||(e._isDigested=!0,c()),r(e)},this.http=function(t){return t=i(t),t.transformRequest=t.transformRequest||function(t){return window.ArrayBuffer&&t instanceof window.ArrayBuffer||t instanceof window.Blob?t:e.defaults.transformRequest[0].apply(this,arguments)},t._chunkSize=a.translateScalars(t.resumeChunkSize),t._chunkSize=t._chunkSize?parseInt(t._chunkSize.toString()):null,r(t)},this.translateScalars=function(e){if(angular.isString(e)){if(e.search(/kb/i)===e.length-2)return parseFloat(1024*e.substring(0,e.length-2));if(e.search(/mb/i)===e.length-2)return parseFloat(1048576*e.substring(0,e.length-2));if(e.search(/gb/i)===e.length-2)return parseFloat(1073741824*e.substring(0,e.length-2));if(e.search(/b/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/s/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/m/i)===e.length-1)return parseFloat(60*e.substring(0,e.length-1));if(e.search(/h/i)===e.length-1)return parseFloat(3600*e.substring(0,e.length-1))}return e},this.urlToBlob=function(n){var r=t.defer();return e({url:n,method:"get",responseType:"arraybuffer"}).then(function(e){var t=new Uint8Array(e.data),i=e.headers("content-type")||"image/WebP",a=new window.Blob([t],{type:i}),o=n.match(/.*\/(.+?)(\?.*)?$/);o.length>1&&(a.name=o[1]),r.resolve(a)},function(e){r.reject(e)}),r.promise},this.setDefaults=function(e){this.defaults=e||{}},this.defaults={},this.version=ngFileUpload.version}]),ngFileUpload.service("Upload",["$parse","$timeout","$compile","$q","UploadExif",function(e,t,n,r,i){function a(e,t,n){var i=[c.emptyPromise()];return angular.forEach(e,function(r,a){0===r.type.indexOf("image/jpeg")&&c.attrGetter("ngfFixOrientation",t,n,{$file:r})&&i.push(c.happyPromise(c.applyExifRotation(r),r).then(function(t){e.splice(a,1,t)}))}),r.all(i)}function o(e,t,n,i){var a=c.attrGetter("ngfResize",t,n);if(!a||!c.isResizeSupported()||!e.length)return c.emptyPromise();if(a instanceof Function){var o=r.defer();return a(e).then(function(r){s(r,e,t,n,i).then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)})}return s(a,e,t,n,i)}function s(e,t,n,i,a){function o(r,o){if(0===r.type.indexOf("image")){if(e.pattern&&!c.validatePattern(r,e.pattern))return;e.resizeIf=function(e,t){return c.attrGetter("ngfResizeIf",n,i,{$width:e,$height:t,$file:r})};var u=c.resize(r,e);s.push(u),u.then(function(e){t.splice(o,1,e)},function(e){r.$error="resize",(r.$errorMessages=r.$errorMessages||{}).resize=!0,r.$errorParam=(e?(e.message?e.message:e)+": ":"")+(r&&r.name),a.$ngfValidations.push({name:"resize",valid:!1}),c.applyModelValidation(a,t)})}}for(var s=[c.emptyPromise()],u=0;u<t.length;u++)o(t[u],u);return r.all(s)}var c=i;return c.getAttrWithDefaults=function(e,t){if(null!=e[t])return e[t];var n=c.defaults[t];return null==n?n:angular.isString(n)?n:JSON.stringify(n)},c.attrGetter=function(t,n,r,i){var a=this.getAttrWithDefaults(n,t);if(!r)return a;try{return i?e(a)(r,i):e(a)(r)}catch(o){if(t.search(/min|max|pattern/i))return a;throw o}},c.shouldUpdateOn=function(e,t,n){var r=c.attrGetter("ngfModelOptions",t,n);return r&&r.updateOn?r.updateOn.split(" ").indexOf(e)>-1:!0},c.emptyPromise=function(){var e=r.defer(),n=arguments;return t(function(){e.resolve.apply(e,n)}),e.promise},c.rejectPromise=function(){var e=r.defer(),n=arguments;return t(function(){e.reject.apply(e,n)}),e.promise},c.happyPromise=function(e,n){var i=r.defer();return e.then(function(e){i.resolve(e)},function(e){t(function(){throw e}),i.resolve(n)}),i.promise},c.updateModel=function(n,r,i,s,u,l,d){function f(a,o,u,d,f){r.$$ngfPrevValidFiles=a,r.$$ngfPrevInvalidFiles=o;var p=a&&a.length?a[0]:null,h=o&&o.length?o[0]:null;n&&(c.applyModelValidation(n,a),n.$setViewValue(f?p:a)),s&&e(s)(i,{$files:a,$file:p,$newFiles:u,$duplicateFiles:d,$invalidFiles:o,$invalidFile:h,$event:l});var g=c.attrGetter("ngfModelInvalid",r);g&&t(function(){e(g).assign(i,f?h:o)}),t(function(){})}function p(){function e(e,t){return e.name===t.name&&(e.$ngfOrigSize||e.size)===(t.$ngfOrigSize||t.size)&&e.type===t.type}function t(t){var n;for(n=0;n<v.length;n++)if(e(t,v[n]))return!0;for(n=0;n<y.length;n++)if(e(t,y[n]))return!0;return!1}if(u){m=[],w=[];for(var n=0;n<u.length;n++)t(u[n])?w.push(u[n]):m.push(u[n])}}function h(e){return angular.isArray(e)?e:[e]}function g(){function e(){t(function(){f(k?v.concat(b):b,k?y.concat(_):_,u,w,S)},$&&$.debounce?$.debounce.change||$.debounce:0)}var a=x?m:b;o(a,r,i,n).then(function(){x?c.validate(m,k?v.length:0,n,r,i).then(function(t){b=t.validsFiles,_=t.invalidsFiles,e()}):e()},function(){for(var t=0;t<a.length;t++){var n=a[t];if("resize"===n.$error){var r=b.indexOf(n);r>-1&&(b.splice(r,1),_.push(n)),e()}}})}var m,v,y,w=[],_=[],b=[];v=r.$$ngfPrevValidFiles||[],y=r.$$ngfPrevInvalidFiles||[],n&&n.$modelValue&&(v=h(n.$modelValue));var k=c.attrGetter("ngfKeep",r,i);m=(u||[]).slice(0),("distinct"===k||c.attrGetter("ngfKeepDistinct",r,i)===!0)&&p(r,i);var S=!k&&!c.attrGetter("ngfMultiple",r,i)&&!c.attrGetter("multiple",r);if(!k||m.length){c.attrGetter("ngfBeforeModelChange",r,i,{$files:u,$file:u&&u.length?u[0]:null,$newFiles:m,$duplicateFiles:w,$event:l});var x=c.attrGetter("ngfValidateAfterResize",r,i),$=c.attrGetter("ngfModelOptions",r,i);c.validate(m,k?v.length:0,n,r,i).then(function(e){d?f(m,[],u,w,S):($&&$.allowInvalid||x?b=m:(b=e.validFiles,_=e.invalidFiles),c.attrGetter("ngfFixOrientation",r,i)&&c.isExifSupported()?a(b,r,i).then(function(){g()}):g())})}},c}]),ngFileUpload.directive("ngfSelect",["$parse","$timeout","$compile","Upload",function(e,t,n,r){function i(e){var t=e.match(/Android[^\d]*(\d+)\.(\d+)/);if(t&&t.length>2){var n=r.defaults.androidFixMinorVersion||4;return parseInt(t[1])<4||parseInt(t[1])===n&&parseInt(t[2])<n}return-1===e.indexOf("Chrome")&&/.*Windows.*Safari.*/.test(e)}function a(e,t,n,r,a,s,c,u){function l(){return"input"===t[0].tagName.toLowerCase()&&n.type&&"file"===n.type.toLowerCase()}function d(){return w("ngfChange")||w("ngfSelect")}function f(t){if(u.shouldUpdateOn("change",n,e)){var i=t.__files_||t.target&&t.target.files,a=[];if(!i)return;for(var o=0;o<i.length;o++)a.push(i[o]);u.updateModel(r,n,e,d(),a.length?a:null,t)}}function p(e,r){function i(t){e.attr("id","ngf-"+t),r.attr("id","ngf-label-"+t)}for(var a=0;a<t[0].attributes.length;a++){var o=t[0].attributes[a];"type"!==o.name&&"class"!==o.name&&"style"!==o.name&&("id"===o.name?(i(o.value),_.push(n.$observe("id",i))):e.attr(o.name,o.value||"required"!==o.name&&"multiple"!==o.name?o.value:o.name))}}function h(){if(l())return t;var e=angular.element('<input type="file">'),n=angular.element("<label>upload</label>");return n.css("visibility","hidden").css("position","absolute").css("overflow","hidden").css("width","0px").css("height","0px").css("border","none").css("margin","0px").css("padding","0px").attr("tabindex","-1"),p(e,n),o.push({el:t,ref:n}),document.body.appendChild(n.append(e)[0]),e}function g(n){if(t.attr("disabled"))return!1;if(!w("ngfSelectDisabled",e)){var r=m(n);if(null!=r)return r;v(n);try{l()||document.body.contains(S[0])||(o.push({el:t,ref:S.parent()}),document.body.appendChild(S.parent()[0]),S.bind("change",f))}catch(a){}return i(navigator.userAgent)?setTimeout(function(){S[0].click()},0):S[0].click(),!1}}function m(e){var t=e.changedTouches||e.originalEvent&&e.originalEvent.changedTouches;if(t){if("touchstart"===e.type)return k=t[0].clientX,b=t[0].clientY,!0;if("touchend"===e.type){var n=t[0].clientX,r=t[0].clientY;if(Math.abs(n-k)>20||Math.abs(r-b)>20)return e.stopPropagation(),e.preventDefault(),!1}return!0}}function v(t){u.shouldUpdateOn("click",n,e)&&S.val()&&(S.val(null),u.updateModel(r,n,e,d(),null,t,!0))}function y(e){if(S&&!S.attr("__ngf_ie10_Fix_")){if(!S[0].parentNode)return void(S=null);e.preventDefault(),e.stopPropagation(),S.unbind("click");var t=S.clone();return S.replaceWith(t),S=t,S.attr("__ngf_ie10_Fix_","true"),S.bind("change",f),S.bind("click",y),S[0].click(),!1}S.removeAttr("__ngf_ie10_Fix_")}var w=function(e,t){return u.attrGetter(e,n,t)};u.registerModelChangeValidator(r,n,e);var _=[];w("ngfMultiple")&&_.push(e.$watch(w("ngfMultiple"),function(){S.attr("multiple",w("ngfMultiple",e))})),w("ngfCapture")&&_.push(e.$watch(w("ngfCapture"),function(){S.attr("capture",w("ngfCapture",e))})),w("ngfAccept")&&_.push(e.$watch(w("ngfAccept"),function(){S.attr("accept",w("ngfAccept",e))})),_.push(n.$observe("accept",function(){S.attr("accept",w("accept"))}));var b=0,k=0,S=t;l()||(S=h()),S.bind("change",f),l()?t.bind("click",v):t.bind("click touchstart touchend",g),-1!==navigator.appVersion.indexOf("MSIE 10")&&S.bind("click",y),r&&r.$formatters.push(function(e){return(null==e||0===e.length)&&S.val()&&S.val(null),e}),e.$on("$destroy",function(){l()||S.parent().remove(),angular.forEach(_,function(e){e()})}),s(function(){for(var e=0;e<o.length;e++){var t=o[e];document.body.contains(t.el[0])||(o.splice(e,1),t.ref.remove())}}),window.FileAPI&&window.FileAPI.ngfFixIE&&window.FileAPI.ngfFixIE(t,S,f)}var o=[];return{restrict:"AEC",require:"?ngModel",link:function(i,o,s,c){a(i,o,s,c,e,t,n,r)}}}]),function(){function e(e){return"img"===e.tagName.toLowerCase()?"image":"audio"===e.tagName.toLowerCase()?"audio":"video"===e.tagName.toLowerCase()?"video":/./}function t(t,n,r,i,a,o,s,c){function u(e){var o=t.attrGetter("ngfNoObjectUrl",a,r);t.dataUrl(e,o)["finally"](function(){n(function(){var t=(o?e.$ngfDataUrl:e.$ngfBlobUrl)||e.$ngfDataUrl;c?i.css("background-image","url('"+(t||"")+"')"):i.attr("src",t),t?i.removeClass("ng-hide"):i.addClass("ng-hide")})})}n(function(){var n=r.$watch(a[o],function(n){var l=s;if("ngfThumbnail"===o&&(l||(l={width:i[0].naturalWidth||i[0].clientWidth,height:i[0].naturalHeight||i[0].clientHeight}),0===l.width&&window.getComputedStyle)){var d=getComputedStyle(i[0]);d.width&&d.width.indexOf("px")>-1&&d.height&&d.height.indexOf("px")>-1&&(l={width:parseInt(d.width.slice(0,-2)),height:parseInt(d.height.slice(0,-2))})}return angular.isString(n)?(i.removeClass("ng-hide"),c?i.css("background-image","url('"+n+"')"):i.attr("src",n)):void(!n||!n.type||0!==n.type.search(e(i[0]))||c&&0!==n.type.indexOf("image")?i.addClass("ng-hide"):l&&t.isResizeSupported()?(l.resizeIf=function(e,i){return t.attrGetter("ngfResizeIf",a,r,{$width:e,$height:i,$file:n})},t.resize(n,l).then(function(e){u(e)},function(e){throw e})):u(n))});r.$on("$destroy",function(){n()})})}ngFileUpload.service("UploadDataUrl",["UploadBase","$timeout","$q",function(e,t,n){var r=e;return r.base64DataUrl=function(e){if(angular.isArray(e)){var t=n.defer(),i=0;return angular.forEach(e,function(n){r.dataUrl(n,!0)["finally"](function(){if(i++,i===e.length){var n=[];angular.forEach(e,function(e){n.push(e.$ngfDataUrl)}),t.resolve(n,e)}})}),t.promise}return r.dataUrl(e,!0)},r.dataUrl=function(e,i){if(!e)return r.emptyPromise(e,e);if(i&&null!=e.$ngfDataUrl||!i&&null!=e.$ngfBlobUrl)return r.emptyPromise(i?e.$ngfDataUrl:e.$ngfBlobUrl,e);var a=i?e.$$ngfDataUrlPromise:e.$$ngfBlobUrlPromise;if(a)return a;var o=n.defer();return t(function(){if(window.FileReader&&e&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 8")||e.size<2e4)&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 9")||e.size<4e6)){var n=window.URL||window.webkitURL;if(n&&n.createObjectURL&&!i){var a;try{a=n.createObjectURL(e)}catch(s){return void t(function(){e.$ngfBlobUrl="",o.reject()})}t(function(){if(e.$ngfBlobUrl=a,a){o.resolve(a,e),r.blobUrls=r.blobUrls||[],r.blobUrlsTotalSize=r.blobUrlsTotalSize||0,r.blobUrls.push({url:a,size:e.size}),r.blobUrlsTotalSize+=e.size||0;for(var t=r.defaults.blobUrlsMaxMemory||268435456,i=r.defaults.blobUrlsMaxQueueSize||200;(r.blobUrlsTotalSize>t||r.blobUrls.length>i)&&r.blobUrls.length>1;){var s=r.blobUrls.splice(0,1)[0];n.revokeObjectURL(s.url),r.blobUrlsTotalSize-=s.size}}})}else{var c=new FileReader;c.onload=function(n){t(function(){e.$ngfDataUrl=n.target.result,o.resolve(n.target.result,e),t(function(){delete e.$ngfDataUrl},1e3)})},c.onerror=function(){t(function(){e.$ngfDataUrl="",o.reject()})},c.readAsDataURL(e)}}else t(function(){e[i?"$ngfDataUrl":"$ngfBlobUrl"]="",o.reject()})}),a=i?e.$$ngfDataUrlPromise=o.promise:e.$$ngfBlobUrlPromise=o.promise,a["finally"](function(){delete e[i?"$$ngfDataUrlPromise":"$$ngfBlobUrlPromise"]}),a},r}]),ngFileUpload.directive("ngfSrc",["Upload","$timeout",function(e,n){return{restrict:"AE",link:function(r,i,a){t(e,n,r,i,a,"ngfSrc",e.attrGetter("ngfResize",a,r),!1)}}}]),ngFileUpload.directive("ngfBackground",["Upload","$timeout",function(e,n){return{restrict:"AE",link:function(r,i,a){t(e,n,r,i,a,"ngfBackground",e.attrGetter("ngfResize",a,r),!0)}}}]),ngFileUpload.directive("ngfThumbnail",["Upload","$timeout",function(e,n){return{restrict:"AE",link:function(r,i,a){var o=e.attrGetter("ngfSize",a,r);t(e,n,r,i,a,"ngfThumbnail",o,e.attrGetter("ngfAsBackground",a,r))}}}]),ngFileUpload.config(["$compileProvider",function(e){e.imgSrcSanitizationWhitelist&&e.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/),e.aHrefSanitizationWhitelist&&e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/)}]),ngFileUpload.filter("ngfDataUrl",["UploadDataUrl","$sce",function(e,t){return function(n,r,i){if(angular.isString(n))return t.trustAsResourceUrl(n);var a=n&&((r?n.$ngfDataUrl:n.$ngfBlobUrl)||n.$ngfDataUrl);return n&&!a?(!n.$ngfDataUrlFilterInProgress&&angular.isObject(n)&&(n.$ngfDataUrlFilterInProgress=!0,e.dataUrl(n,r)),""):(n&&delete n.$ngfDataUrlFilterInProgress,(n&&a?i?t.trustAsResourceUrl(a):a:n)||"")}}])}(),ngFileUpload.service("UploadValidate",["UploadDataUrl","$q","$timeout",function(e,t,n){function r(e){var t="",n=[];if(e.length>2&&"/"===e[0]&&"/"===e[e.length-1])t=e.substring(1,e.length-1);else{var i=e.split(",");if(i.length>1)for(var a=0;a<i.length;a++){var o=r(i[a]);o.regexp?(t+="("+o.regexp+")",a<i.length-1&&(t+="|")):n=n.concat(o.excludes)}else 0===e.indexOf("!")?n.push("^((?!"+r(e.substring(1)).regexp+").)*$"):(0===e.indexOf(".")&&(e="*"+e),t="^"+e.replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")+"$",t=t.replace(/\\\*/g,".*").replace(/\\\?/g,"."))}return{regexp:t,excludes:n}}function i(e,t){null==t||e.$dirty||(e.$setDirty?e.$setDirty():e.$dirty=!0)}var a=e;return a.validatePattern=function(e,t){if(!t)return!0;var n=r(t),i=!0;if(n.regexp&&n.regexp.length){var a=new RegExp(n.regexp,"i");i=null!=e.type&&a.test(e.type)||null!=e.name&&a.test(e.name)}for(var o=n.excludes.length;o--;){var s=new RegExp(n.excludes[o],"i");i=i&&(null==e.type||s.test(e.type))&&(null==e.name||s.test(e.name))}return i},a.ratioToFloat=function(e){var t=e.toString(),n=t.search(/[x:]/i);return t=n>-1?parseFloat(t.substring(0,n))/parseFloat(t.substring(n+1)):parseFloat(t)},a.registerModelChangeValidator=function(e,t,n){e&&e.$formatters.push(function(r){if(e.$dirty){var i=r;r&&!angular.isArray(r)&&(i=[r]),a.validate(i,0,e,t,n).then(function(){a.applyModelValidation(e,i)})}return r})},a.applyModelValidation=function(e,t){i(e,t),angular.forEach(e.$ngfValidations,function(t){e.$setValidity(t.name,t.valid)})},a.getValidationAttr=function(e,t,n,r,i){var o="ngf"+n[0].toUpperCase()+n.substr(1),s=a.attrGetter(o,e,t,{$file:i});if(null==s&&(s=a.attrGetter("ngfValidate",e,t,{$file:i}))){var c=(r||n).split(".");s=s[c[0]],c.length>1&&(s=s&&s[c[1]])}return s},a.validate=function(e,n,r,i,o){function s(t,n,s){if(e){for(var c=e.length,u=null;c--;){var p=e[c];if(p){var h=a.getValidationAttr(i,o,t,n,p);null!=h&&(s(p,h,c)||(-1===l.indexOf(t)?(p.$error=t,(p.$errorMessages=p.$errorMessages||{})[t]=!0,p.$errorParam=h,-1===f.indexOf(p)&&f.push(p),d||e.splice(c,1),u=!1):e.splice(c,1)))}}null!==u&&r.$ngfValidations.push({name:t,valid:u})}}function c(n,s,c,p,h){function g(t,r,i){function a(a){if(a())if(-1===l.indexOf(n)){if(r.$error=n,(r.$errorMessages=r.$errorMessages||{})[n]=!0,r.$errorParam=i,-1===f.indexOf(r)&&f.push(r),!d){var o=e.indexOf(r);o>-1&&e.splice(o,1)}t.resolve(!1)}else{var s=e.indexOf(r);s>-1&&e.splice(s,1),t.resolve(!0)}else t.resolve(!0)}null!=i?p(r,i).then(function(e){a(function(){return!h(e,i)})},function(){a(function(){return u("ngfValidateForce",{$file:r})})}):t.resolve(!0)}var m=[a.emptyPromise(!0)];e&&(e=void 0===e.length?[e]:e,angular.forEach(e,function(e){var r=t.defer();return m.push(r.promise),!c||null!=e.type&&0===e.type.search(c)?void("dimensions"===n&&null!=a.attrGetter("ngfDimensions",i)?a.imageDimensions(e).then(function(t){g(r,e,u("ngfDimensions",{$file:e,$width:t.width,$height:t.height}))},function(){r.resolve(!1)}):"duration"===n&&null!=a.attrGetter("ngfDuration",i)?a.mediaDuration(e).then(function(t){g(r,e,u("ngfDuration",{$file:e,$duration:t}))},function(){r.resolve(!1)}):g(r,e,a.getValidationAttr(i,o,n,s,e))):void r.resolve(!0)}));var v=t.defer();return t.all(m).then(function(e){for(var t=!0,i=0;i<e.length;i++)if(!e[i]){t=!1;break}r.$ngfValidations.push({name:n,valid:t}),v.resolve(t)}),v.promise}r=r||{},r.$ngfValidations=r.$ngfValidations||[],angular.forEach(r.$ngfValidations,function(e){e.valid=!0});var u=function(e,t){return a.attrGetter(e,i,o,t)},l=(a.attrGetter("ngfIgnoreInvalid",i,o)||"").split(" "),d=a.attrGetter("ngfRunAllValidations",i,o);if(null==e||0===e.length)return a.emptyPromise({validFiles:e,invalidFiles:[]});e=void 0===e.length?[e]:e.slice(0);var f=[];s("pattern",null,a.validatePattern),s("minSize","size.min",function(e,t){return e.size+.1>=a.translateScalars(t)}),s("maxSize","size.max",function(e,t){return e.size-.1<=a.translateScalars(t)});var p=0;if(s("maxTotalSize",null,function(t,n){return p+=t.size,p>a.translateScalars(n)?(e.splice(0,e.length),!1):!0}),s("validateFn",null,function(e,t){return t===!0||null===t||""===t}),!e.length)return a.emptyPromise({validFiles:[],invalidFiles:f});var h=t.defer(),g=[];return g.push(c("maxHeight","height.max",/image/,this.imageDimensions,function(e,t){return e.height<=t})),g.push(c("minHeight","height.min",/image/,this.imageDimensions,function(e,t){return e.height>=t})),g.push(c("maxWidth","width.max",/image/,this.imageDimensions,function(e,t){return e.width<=t})),g.push(c("minWidth","width.min",/image/,this.imageDimensions,function(e,t){return e.width>=t})),g.push(c("dimensions",null,/image/,function(e,t){return a.emptyPromise(t)},function(e){return e})),g.push(c("ratio",null,/image/,this.imageDimensions,function(e,t){for(var n=t.toString().split(","),r=!1,i=0;i<n.length;i++)Math.abs(e.width/e.height-a.ratioToFloat(n[i]))<.01&&(r=!0);return r})),g.push(c("maxRatio","ratio.max",/image/,this.imageDimensions,function(e,t){return e.width/e.height-a.ratioToFloat(t)<1e-4})),g.push(c("minRatio","ratio.min",/image/,this.imageDimensions,function(e,t){return e.width/e.height-a.ratioToFloat(t)>-1e-4})),g.push(c("maxDuration","duration.max",/audio|video/,this.mediaDuration,function(e,t){return e<=a.translateScalars(t)})),g.push(c("minDuration","duration.min",/audio|video/,this.mediaDuration,function(e,t){return e>=a.translateScalars(t)})),g.push(c("duration",null,/audio|video/,function(e,t){return a.emptyPromise(t)},function(e){return e})),g.push(c("validateAsyncFn",null,null,function(e,t){return t},function(e){return e===!0||null===e||""===e})),t.all(g).then(function(){if(d)for(var t=0;t<e.length;t++){var r=e[t];r.$error&&e.splice(t--,1)}d=!1,s("maxFiles",null,function(e,t,r){return t>n+r}),h.resolve({validFiles:e,invalidFiles:f})}),h.promise},a.imageDimensions=function(e){if(e.$ngfWidth&&e.$ngfHeight){var r=t.defer();return n(function(){r.resolve({width:e.$ngfWidth,height:e.$ngfHeight})}),r.promise}if(e.$ngfDimensionPromise)return e.$ngfDimensionPromise;var i=t.defer();return n(function(){return 0!==e.type.indexOf("image")?void i.reject("not image"):void a.dataUrl(e).then(function(t){function r(){var t=s[0].naturalWidth||s[0].clientWidth,n=s[0].naturalHeight||s[0].clientHeight;s.remove(),e.$ngfWidth=t,e.$ngfHeight=n,i.resolve({width:t,height:n})}function a(){s.remove(),i.reject("load error")}function o(){n(function(){s[0].parentNode&&(s[0].clientWidth?r():c++>10?a():o())},1e3)}var s=angular.element("<img>").attr("src",t).css("visibility","hidden").css("position","fixed").css("max-width","none !important").css("max-height","none !important");s.on("load",r),s.on("error",a);var c=0;o(),angular.element(document.getElementsByTagName("body")[0]).append(s)},function(){i.reject("load error")})}),e.$ngfDimensionPromise=i.promise,e.$ngfDimensionPromise["finally"](function(){delete e.$ngfDimensionPromise}),e.$ngfDimensionPromise},a.mediaDuration=function(e){if(e.$ngfDuration){var r=t.defer();return n(function(){r.resolve(e.$ngfDuration)}),r.promise}if(e.$ngfDurationPromise)return e.$ngfDurationPromise;var i=t.defer();return n(function(){return 0!==e.type.indexOf("audio")&&0!==e.type.indexOf("video")?void i.reject("not media"):void a.dataUrl(e).then(function(t){function r(){var t=s[0].duration;
e.$ngfDuration=t,s.remove(),i.resolve(t)}function a(){s.remove(),i.reject("load error")}function o(){n(function(){s[0].parentNode&&(s[0].duration?r():c>10?a():o())},1e3)}var s=angular.element(0===e.type.indexOf("audio")?"<audio>":"<video>").attr("src",t).css("visibility","none").css("position","fixed");s.on("loadedmetadata",r),s.on("error",a);var c=0;o(),angular.element(document.body).append(s)},function(){i.reject("load error")})}),e.$ngfDurationPromise=i.promise,e.$ngfDurationPromise["finally"](function(){delete e.$ngfDurationPromise}),e.$ngfDurationPromise},a}]),ngFileUpload.service("UploadResize",["UploadValidate","$q",function(e,t){var n=e,r=function(e,t,n,r,i){var a=i?Math.max(n/e,r/t):Math.min(n/e,r/t);return{width:e*a,height:t*a,marginX:e*a-n,marginY:t*a-r}},i=function(e,i,a,o,s,c,u,l){var d=t.defer(),f=document.createElement("canvas"),p=document.createElement("img");return p.setAttribute("style","visibility:hidden;position:fixed;z-index:-100000"),document.body.appendChild(p),p.onload=function(){var e=p.width,t=p.height;if(p.parentNode.removeChild(p),null!=l&&l(e,t)===!1)return void d.reject("resizeIf");try{if(c){var h=n.ratioToFloat(c),g=e/t;h>g?(i=e,a=i/h):(a=t,i=a*h)}i||(i=e),a||(a=t);var m=r(e,t,i,a,u);f.width=Math.min(m.width,i),f.height=Math.min(m.height,a);var v=f.getContext("2d");v.drawImage(p,Math.min(0,-m.marginX/2),Math.min(0,-m.marginY/2),m.width,m.height),d.resolve(f.toDataURL(s||"image/WebP",o||.934))}catch(y){d.reject(y)}},p.onerror=function(){p.parentNode.removeChild(p),d.reject()},p.src=e,d.promise};return n.dataUrltoBlob=function(e,t,n){for(var r=e.split(","),i=r[0].match(/:(.*?);/)[1],a=atob(r[1]),o=a.length,s=new Uint8Array(o);o--;)s[o]=a.charCodeAt(o);var c=new window.Blob([s],{type:i});return c.name=t,c.$ngfOrigSize=n,c},n.isResizeSupported=function(){var e=document.createElement("canvas");return window.atob&&e.getContext&&e.getContext("2d")&&window.Blob},n.isResizeSupported()&&Object.defineProperty(window.Blob.prototype,"name",{get:function(){return this.$ngfName},set:function(e){this.$ngfName=e},configurable:!0}),n.resize=function(e,r){if(0!==e.type.indexOf("image"))return n.emptyPromise(e);var a=t.defer();return n.dataUrl(e,!0).then(function(t){i(t,r.width,r.height,r.quality,r.type||e.type,r.ratio,r.centerCrop,r.resizeIf).then(function(i){if("image/jpeg"===e.type&&r.restoreExif!==!1)try{i=n.restoreExif(t,i)}catch(o){setTimeout(function(){throw o},1)}try{var s=n.dataUrltoBlob(i,e.name,e.size);a.resolve(s)}catch(o){a.reject(o)}},function(t){"resizeIf"===t&&a.resolve(e),a.reject(t)})},function(e){a.reject(e)}),a.promise},n}]),function(){function e(e,n,r,i,a,o,s,c,u,l){function d(){return n.attr("disabled")||y("ngfDropDisabled",e)}function f(t,n,r){if(t){var i;try{i=t&&t.getData&&t.getData("text/html")}catch(a){}m(t.items,t.files,y("ngfAllowDir",e)!==!1,y("multiple")||y("ngfMultiple",e)).then(function(e){e.length?p(e,n):h(r,i).then(function(e){p(e,n)})})}}function p(t,n){c.updateModel(i,r,e,y("ngfChange")||y("ngfDrop"),t,n)}function h(t,n){if(!c.shouldUpdateOn(t,r,e)||"string"!=typeof n)return c.rejectPromise([]);var i=[];n.replace(/<(img src|img [^>]* src) *=\"([^\"]*)\"/gi,function(e,t,n){i.push(n)});var a=[],o=[];if(i.length){angular.forEach(i,function(e){a.push(c.urlToBlob(e).then(function(e){o.push(e)}))});var s=l.defer();return l.all(a).then(function(){s.resolve(o)},function(e){s.reject(e)}),s.promise}return c.emptyPromise()}function g(e,t,n,r){var i=y("ngfDragOverClass",e,{$event:n}),a="dragover";if(angular.isString(i))a=i;else if(i&&(i.delay&&(k=i.delay),i.accept||i.reject)){var o=n.dataTransfer.items;if(null!=o&&o.length)for(var s=i.pattern||y("ngfPattern",e,{$event:n}),u=o.length;u--;){if(!c.validatePattern(o[u],s)){a=i.reject;break}a=i.accept}else a=i.accept}r(a)}function m(t,n,i,a){function o(e,t){var n=l.defer();if(null!=e)if(e.isDirectory){var r=[c.emptyPromise()];if(f){var i={type:"directory"};i.name=i.path=(t||"")+e.name,p.push(i)}var a=e.createReader(),s=[],g=function(){a.readEntries(function(i){try{i.length?(s=s.concat(Array.prototype.slice.call(i||[],0)),g()):(angular.forEach(s.slice(0),function(n){p.length<=u&&d>=h&&r.push(o(n,(t?t:"")+e.name+"/"))}),l.all(r).then(function(){n.resolve()},function(e){n.reject(e)}))}catch(a){n.reject(a)}},function(e){n.reject(e)})};g()}else e.file(function(e){try{e.path=(t?t:"")+e.name,f&&(e=c.rename(e,e.path)),p.push(e),h+=e.size,n.resolve()}catch(r){n.reject(r)}},function(e){n.reject(e)});return n.promise}var u=c.getValidationAttr(r,e,"maxFiles");null==u&&(u=Number.MAX_VALUE);var d=c.getValidationAttr(r,e,"maxTotalSize");null==d&&(d=Number.MAX_VALUE);var f=y("ngfIncludeDir",e),p=[],h=0,g=[c.emptyPromise()];if(t&&t.length>0&&"file:"!==s.location.protocol)for(var m=0;m<t.length;m++){if(t[m].webkitGetAsEntry&&t[m].webkitGetAsEntry()&&t[m].webkitGetAsEntry().isDirectory){var v=t[m].webkitGetAsEntry();if(v.isDirectory&&!i)continue;null!=v&&g.push(o(v))}else{var w=t[m].getAsFile();null!=w&&(p.push(w),h+=w.size)}if(p.length>u||h>d||!a&&p.length>0)break}else if(null!=n)for(var _=0;_<n.length;_++){var b=n.item(_);if((b.type||b.size>0)&&(p.push(b),h+=b.size),p.length>u||h>d||!a&&p.length>0)break}var k=l.defer();return l.all(g).then(function(){if(a||f||!p.length)k.resolve(p);else{for(var e=0;p[e]&&"directory"===p[e].type;)e++;k.resolve([p[e]])}},function(e){k.reject(e)}),k.promise}var v=t(),y=function(e,t,n){return c.attrGetter(e,r,t,n)};if(y("dropAvailable")&&o(function(){e[y("dropAvailable")]?e[y("dropAvailable")].value=v:e[y("dropAvailable")]=v}),!v)return void(y("ngfHideOnDropNotAvailable",e)===!0&&n.css("display","none"));null==y("ngfSelect")&&c.registerModelChangeValidator(i,r,e);var w,_=null,b=a(y("ngfStopPropagation")),k=1;n[0].addEventListener("dragover",function(t){if(!d()&&c.shouldUpdateOn("drop",r,e)){if(t.preventDefault(),b(e)&&t.stopPropagation(),navigator.userAgent.indexOf("Chrome")>-1){var i=t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy"}o.cancel(_),w||(w="C",g(e,r,t,function(r){w=r,n.addClass(w),y("ngfDrag",e,{$isDragging:!0,$class:w,$event:t})}))}},!1),n[0].addEventListener("dragenter",function(t){!d()&&c.shouldUpdateOn("drop",r,e)&&(t.preventDefault(),b(e)&&t.stopPropagation())},!1),n[0].addEventListener("dragleave",function(t){!d()&&c.shouldUpdateOn("drop",r,e)&&(t.preventDefault(),b(e)&&t.stopPropagation(),_=o(function(){w&&n.removeClass(w),w=null,y("ngfDrag",e,{$isDragging:!1,$event:t})},k||100))},!1),n[0].addEventListener("drop",function(t){!d()&&c.shouldUpdateOn("drop",r,e)&&(t.preventDefault(),b(e)&&t.stopPropagation(),w&&n.removeClass(w),w=null,f(t.dataTransfer,t,"dropUrl"))},!1),n[0].addEventListener("paste",function(t){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&y("ngfEnableFirefoxPaste",e)&&t.preventDefault(),!d()&&c.shouldUpdateOn("paste",r,e)&&f(t.clipboardData||t.originalEvent.clipboardData,t,"pasteUrl")},!1),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&y("ngfEnableFirefoxPaste",e)&&(n.attr("contenteditable",!0),n.on("keypress",function(e){e.metaKey||e.ctrlKey||e.preventDefault()}))}function t(){var e=document.createElement("div");return"draggable"in e&&"ondrop"in e&&!/Edge\/12./i.test(navigator.userAgent)}ngFileUpload.directive("ngfDrop",["$parse","$timeout","$window","Upload","$http","$q",function(t,n,r,i,a,o){return{restrict:"AEC",require:"?ngModel",link:function(s,c,u,l){e(s,c,u,l,t,n,r,i,a,o)}}}]),ngFileUpload.directive("ngfNoFileDrop",function(){return function(e,n){t()&&n.css("display","none")}}),ngFileUpload.directive("ngfDropAvailable",["$parse","$timeout","Upload",function(e,n,r){return function(i,a,o){if(t()){var s=e(r.attrGetter("ngfDropAvailable",o));n(function(){s(i),s.assign&&s.assign(i,!0)})}}}])}(),ngFileUpload.service("UploadExif",["UploadResize","$q",function(e,t){function n(e,t,n,r){switch(t){case 2:return e.transform(-1,0,0,1,n,0);case 3:return e.transform(-1,0,0,-1,n,r);case 4:return e.transform(1,0,0,-1,0,r);case 5:return e.transform(0,1,1,0,0,0);case 6:return e.transform(0,1,-1,0,r,0);case 7:return e.transform(0,-1,-1,0,r,n);case 8:return e.transform(0,-1,1,0,0,n)}}function r(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;r>i;i++)t+=String.fromCharCode(n[i]);return window.btoa(t)}var i=e;return i.isExifSupported=function(){return window.FileReader&&(new FileReader).readAsArrayBuffer&&i.isResizeSupported()},i.readOrientation=function(e){var n=t.defer(),r=new FileReader,i=e.slice?e.slice(0,65536):e;return r.readAsArrayBuffer(i),r.onerror=function(e){return n.reject(e)},r.onload=function(e){var t={orientation:1},r=new DataView(this.result);if(65496!==r.getUint16(0,!1))return n.resolve(t);for(var i=r.byteLength,a=2;i>a;){var o=r.getUint16(a,!1);if(a+=2,65505===o){if(1165519206!==r.getUint32(a+=2,!1))return n.resolve(t);var s=18761===r.getUint16(a+=6,!1);a+=r.getUint32(a+4,s);var c=r.getUint16(a,s);a+=2;for(var u=0;c>u;u++)if(274===r.getUint16(a+12*u,s)){var l=r.getUint16(a+12*u+8,s);return l>=2&&8>=l&&(r.setUint16(a+12*u+8,1,s),t.fixedArrayBuffer=e.target.result),t.orientation=l,n.resolve(t)}}else{if(65280!==(65280&o))break;a+=r.getUint16(a,!1)}}return n.resolve(t)},n.promise},i.applyExifRotation=function(e){if(0!==e.type.indexOf("image/jpeg"))return i.emptyPromise(e);var a=t.defer();return i.readOrientation(e).then(function(t){return t.orientation<2||t.orientation>8?a.resolve(e):void i.dataUrl(e,!0).then(function(o){var s=document.createElement("canvas"),c=document.createElement("img");c.onload=function(){try{s.width=t.orientation>4?c.height:c.width,s.height=t.orientation>4?c.width:c.height;var o=s.getContext("2d");n(o,t.orientation,c.width,c.height),o.drawImage(c,0,0);var u=s.toDataURL(e.type||"image/WebP",.934);u=i.restoreExif(r(t.fixedArrayBuffer),u);var l=i.dataUrltoBlob(u,e.name);a.resolve(l)}catch(d){return a.reject(d)}},c.onerror=function(){a.reject()},c.src=o},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},i.restoreExif=function(e,t){var n={};return n.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n.encode64=function(e){var t,n,r,i,a,o="",s="",c="",u=0;do t=e[u++],n=e[u++],s=e[u++],r=t>>2,i=(3&t)<<4|n>>4,a=(15&n)<<2|s>>6,c=63&s,isNaN(n)?a=c=64:isNaN(s)&&(c=64),o=o+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(c),t=n=s="",r=i=a=c="";while(u<e.length);return o},n.restore=function(e,t){e.match("data:image/jpeg;base64,")&&(e=e.replace("data:image/jpeg;base64,",""));var n=this.decode64(e),r=this.slice2Segments(n),i=this.exifManipulation(t,r);return"data:image/jpeg;base64,"+this.encode64(i)},n.exifManipulation=function(e,t){var n=this.getExifArray(t),r=this.insertExif(e,n);return new Uint8Array(r)},n.getExifArray=function(e){for(var t,n=0;n<e.length;n++)if(t=e[n],255===t[0]&225===t[1])return t;return[]},n.insertExif=function(e,t){var n=e.replace("data:image/jpeg;base64,",""),r=this.decode64(n),i=r.indexOf(255,3),a=r.slice(0,i),o=r.slice(i),s=a;return s=s.concat(t),s=s.concat(o)},n.slice2Segments=function(e){for(var t=0,n=[];!(255===e[t]&218===e[t+1]);){if(255===e[t]&216===e[t+1])t+=2;else{var r=256*e[t+2]+e[t+3],i=t+r+2,a=e.slice(t,i);n.push(a),t=i}if(t>e.length)break}return n},n.decode64=function(e){var t,n,r,i,a,o="",s="",c=0,u=[],l=/[^A-Za-z0-9\+\/\=]/g;l.exec(e)&&console.log("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, NaNExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=this.KEY_STR.indexOf(e.charAt(c++)),i=this.KEY_STR.indexOf(e.charAt(c++)),a=this.KEY_STR.indexOf(e.charAt(c++)),s=this.KEY_STR.indexOf(e.charAt(c++)),t=r<<2|i>>4,n=(15&i)<<4|a>>2,o=(3&a)<<6|s,u.push(t),64!==a&&u.push(n),64!==s&&u.push(o),t=n=o="",r=i=a=s="";while(c<e.length);return u},n.restore(e,t)},i}]),function(){this.StopWatch=function(){function e(){this.startTime=null,this.endTime=null}return e.prototype.start=function(){return this.startTime=e.now()},e.prototype.end=function(){return this.endTime=e.now()},e.prototype.elapsed=function(){return this.endTime=this.endTime||this.end(),this.endTime-this.startTime},e.prototype.reset=function(){return this.startTime=null,this.endTime=null},e.start=function(){var t;return t=new e,t.start(),t},e.now=function(){return Modernizr.prefixed("performance.now",window)?performance.now:new Date},e}()}.call(this),function(){this.common_services=angular.module("common.services",["ng-rails-csrf"]),this.common_services.factory("clientEventService",["$http",function(e){return{sendClientEvent:function(t,n,r){return null==r&&(r=window.tracking_data?tracking_data.request_id:""),e({method:"POST",url:"/"+application.app_prefix+"/client_event",data:JSON.stringify({name:t,payload:n,request_id:r})})}}}])}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("giSearchByImage").factory("omnitureReady",["$document","$q",function(e,t){var n;return n=t.defer(),null!=window.s&&n.resolve(),e.on("omnitureReady",function(){return n.resolve()}),n.promise}]),angular.module("giSearchByImage").factory("sbiTrackingService",["omnitureReady","$document","$window",function(t,n,r){var i,a,o,c;return a=function(n,r){return t.then(function(){var t;return s.linkTrackEvents=s.events=r,s.linkTrackVars="events",t=["event148","event155","event157","event158","event159","event160","event161","event182","event183"],e.call(t,r)>=0&&(c(s),s.eVar47="D=pageName"),s.tl(!0,"o",n)})},o=function(e,t){return null==t&&(t={}),n.safeReady(function(){return combinedGtmTracking.gtmPushTracking(e,t)})},i=function(e,n){var r;return r=JSON.parse(JSON.stringify(e)),null===r||r.showDimensionError!==!0&&r.showFileSizeError!==!0&&r.showFileTypeError!==!0&&r.showGenericError!==!0?o("SearchByImageCloseModal"):o("SearchByImageError"),t.then(function(){var e;return s.linkTrackEvents=s.events=n?"event212":"event149",e="ImgSrch_modalClose",null!==r&&(c(s),s.eVar47="D=pageName",r.showDimensionError===!0?(s.eVar97="after over 4000px error",e="ImgSrch_clsWndwAftr4000pxError"):r.showFileSizeError===!0?(s.eVar97="after over 5MB error",e="ImgSrch_clsWndwAftr5MBError"):r.showFileTypeError===!0?(s.eVar97="after upload jpeg or png error",e="ImgSrch_clsWndwAftrJpgPngError"):r.showGenericError===!0&&(s.eVar97="after something went wrong error",e="ImgSearch_clsWndwAftrSmthngWntWng")),s.tl(!0,"o",e)})},c=function(e){return e.linkTrackVars+=","+r.pageTrackingVariables+",linkTrackEvents"},{sendEvent:a,sendGtmEvent:o,handleCloseEvent:i}}])}.call(this),function(){angular.module("giCurrentSite",[]),angular.module("giCurrentSite").factory("currentSite",["$window",function(e){return e.currentSite}])}.call(this);